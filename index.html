<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POSH Training Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      color: #333;
      background: url("assets/img2.png") center/cover no-repeat fixed;
      position: relative;
    }

    /* Container */
    .container {
      max-width: 750px;
      margin: 20px auto 40px;
      background: #fff;
      border-radius: 14px;
      border: 2px solid #007BFF;
      padding: 40px;
      position: relative;
      z-index: 2;
    }

    /* Hero */
    .hero {
      font-family: 'Futura', 'Inter', sans-serif;
      color: white;
      padding: 80px 20px;
      text-align: center;
    }
    .hero h1 {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      margin: 15px 10px;
      padding: 14px 28px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background: linear-gradient(120deg, #007BFF, #0056b3);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn:hover {
      background: linear-gradient(120deg, #0056b3, #004080);
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: linear-gradient(120deg, #666, #444);
    }

    .hidden { display: none; }

    .card {
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      background: #fafafa;
    }

    input {
      padding: 12px;
      width: 100%;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <!-- Hero -->
  <div class="hero">
    <h1>POSH Training for Urban Retail</h1>
  </div>

  <!-- Content -->
  <div class="container">

    <!-- Step 1 -->
    <div id="details-section">
      <h2>Verify Your Details</h2>
      <p id="shop-details"></p>
      <p><strong>Are the above details correct?</strong></p>
      <p style="color:#555;">क्या यह जानकारी सही है?</p>
      <button class="btn" id="confirm-btn">Yes, I Confirm</button>
      <button class="btn btn-secondary" id="deny-btn">No, Incorrect Details</button>
    </div>

    <!-- Correction -->
    <div id="correction-section" class="hidden">
      <h2>Enter Correct Details</h2>
      <input type="text" id="correct-shopname" placeholder="Shop Name">
      <input type="text" id="correct-marketname" placeholder="Market Name">
      <button class="btn" id="submit-correction">Submit Correct Details</button>
    </div>

    <!-- Step 2 -->
    <div id="confirmation-section" class="hidden">
      <h2>Your Password</h2>
      <p id="confirmation-msg"></p>
      <div class="card">
        Your Password: <span id="shop-id"></span>
        <p>Please paste this password in the "Nickname" field on the next page.</p>
      </div>
      <button class="btn" id="go-to-links-btn">Proceed to Training</button>
    </div>

    <!-- Step 3 -->
    <div id="final-section" class="hidden">
      <h2>Choose Your Training</h2>
      <div class="card">
        <p><strong>Owner / Manager Training</strong></p>
        <button class="btn" id="btn-employer">Start Employer Training</button>
      </div>
      <div class="card">
        <p><strong>Employee Training</strong></p>
        <button class="btn btn-secondary" id="btn-employee">Start Employee Training</button>
      </div>
    </div>
  </div>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbwBCa-w0fFO_AsZWb8VF3foJVHgFmJMULqTZMFo00rZt48bQ4VR26jqTEjf-KmGdSPeaQ/exec";

    // Visit Counter using localStorage
    function getVisitCount(shopid) {
      let key = `visits_${shopid}`;
      let count = localStorage.getItem(key);
      if (!count) {
        count = 1;
      } else {
        count = parseInt(count) + 1;
      }
      localStorage.setItem(key, count);
      return count;
    }

    function trackUserDetails(shopid, shopname, marketname, role) {
      const visitCount = getVisitCount(shopid);
      fetch(SHEET_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ shopid, shopname, marketname, role, visitCount, timestamp: new Date().toISOString() })
      });
      console.log("Logging:", shopid, shopname, marketname, role, "Visit:", visitCount);
    }

    // Load shop data from JSON
    fetch("shops.json")
      .then(response => response.json())
      .then(shopData => {
        const params = new URLSearchParams(window.location.search);
        const shopIdFromUrl = parseInt(params.get("shopid"));

        const shopDetails = document.getElementById("shop-details");
        const confirmationMsg = document.getElementById("confirmation-msg");
        const shopIdElement = document.getElementById("shop-id");

        const detailsSection = document.getElementById("details-section");
        const correctionSection = document.getElementById("correction-section");
        const confirmationSection = document.getElementById("confirmation-section");
        const finalSection = document.getElementById("final-section");

        let shop = shopData.find(s => s.shopid === shopIdFromUrl);
        if (shop) {
          shopDetails.innerText = `Shop: ${shop.shopname} | Market: ${shop.marketname}`;
        } else {
          shopDetails.innerText = "⚠️ Shop not found!";
        }

        // Yes button
        document.getElementById("confirm-btn").onclick = () => {
          confirmationMsg.innerText = `Confirmed: ${shop.shopname}, ${shop.marketname}`;
          shopIdElement.innerText = shop.shopid;
          detailsSection.classList.add("hidden");
          confirmationSection.classList.remove("hidden");
        };

        // No button
        document.getElementById("deny-btn").onclick = () => {
          detailsSection.classList.add("hidden");
          correctionSection.classList.remove("hidden");
        };

        // Submit corrected details
        document.getElementById("submit-correction").onclick = () => {
          const newShopName = document.getElementById("correct-shopname").value.trim();
          const newMarketName = document.getElementById("correct-marketname").value.trim();
          if (!newShopName || !newMarketName) { alert("Please fill both fields!"); return; }
          shop = { shopid: shopIdFromUrl, shopname: newShopName, marketname: newMarketName };
          confirmationMsg.innerText = `Corrected: ${shop.shopname}, ${shop.marketname}`;
          shopIdElement.innerText = shop.shopid;
          correctionSection.classList.add("hidden");
          confirmationSection.classList.remove("hidden");
          trackUserDetails(shop.shopid, shop.shopname, shop.marketname, "Corrected");
        };

        // Proceed button
        document.getElementById("go-to-links-btn").onclick = () => {
          confirmationSection.classList.add("hidden");
          finalSection.classList.remove("hidden");
          window.scrollTo(0, document.body.scrollHeight);
        };

        // Training links
        const classroom1Link = "https://edpuzzle.com/assignments/68b1a7f9ddde8cb5f8362210/watch";
        const classroom2Link = "https://edpuzzle.com/assignments/68b1a7f9ddde8cb5f8362210/watch";

        document.getElementById("btn-employer").onclick = () => {
          trackUserDetails(shop.shopid, shop.shopname, shop.marketname, "Employer");
          window.location.href = classroom1Link;
        };
        document.getElementById("btn-employee").onclick = () => {
          trackUserDetails(shop.shopid, shop.shopname, shop.marketname, "Employee");
          window.location.href = classroom2Link;
        };
      });
  </script>
</body>
</html>
